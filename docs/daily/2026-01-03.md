---
id: "2026-01-03"
aliases: []
tags:
  - daily-notes
  - mario-rl-project
  - phase-3
  - debugging
  - first-training-run
  - pipeline-integration
created: 2026-01-03
---
# ğŸ“… Friday, January 3, 2026

> _Week 1 of 2026 - Phase 3 Progress: Test Run Complete!_

## ğŸ¯ Today's Goals

- [x] Run first end-to-end training test (1000 timesteps)
- [x] Debug any integration issues
- [x] Verify wandb and PostgreSQL logging
- [ ] Run full 2M timestep training (in progress...)

## âœ… What I Accomplished

**EPIC 3-HOUR DEBUGGING SESSION!** Fixed 12 different issues to get the first successful training run.

### The 12 Bugs Fixed

**1. Module Import Syntax** âœ…
- Error: `ModuleNotFoundError: No module named src/training/train`
- Fix: Changed `src/training/train` â†’ `src.training.train` (dots not slashes!)
- Learning: Python `-m` flag requires module notation

**2. Missing `__init__.py` Files** âœ…
- Error: `No module named src`
- Fix: Created `__init__.py` in `src/` and all subdirectories
- Learning: Python requires explicit package markers

**3. Missing stable-baselines3** âœ…
- Error: `ModuleNotFoundError: No module named 'stable_baselines3'`
- Fix: `poetry add stable-baselines3`
- Bonus error: Typo `stable-baseline3` (singular) â†’ `stable-baselines3` (plural!)

**4. Config Key Mismatches (4 separate issues!)** âœ…
- `config["environment"]["name"]` â†’ `config["environment"]["game"]`
- `config["hyperparameters"]` â†’ `config["dqn_hyperparameters"]`
- `config["experiment"]["policy"]` â†’ `config["dqn_hyperparameters"]["policy"]`
- `config["paths"]["models"]` â†’ `config["paths"]["model_dir"]`
- Learning: YAML structure must EXACTLY match code references

**5. Database Password Mismatch** âœ…
- Error: `password authentication failed for user "mario_rl_user"`
- Fix: Updated password in `db_logger.py` to match PostgreSQL

**6. SQL Query Syntax Error** âœ…
- Error: LSP warnings about malformed string
- Issue: `query = """1` (stray `1` after triple-quote)
- Fix: Removed the typo
- Learning: LSP warnings save you from runtime errors!

**7. Function Signature Mismatch** âœ…
- Error: `TypeError: create_experiment() got an unexpected keyword argument 'name'`
- Issue: Function expects `experiment_name`, `git_commit_hash`, `python_version`, `pytorch_version`
- Fix: Added metadata collection code in `train.py`
- Learning: Reproducibility requires tracking versions and git commits!

**8. Missing shimmy Dependency** âœ…
- Error: `ImportError: Missing shimmy installation`
- Cause: SB3 upgraded to Gymnasium, gym-super-mario-bros still uses old Gym
- Fix: `poetry add 'shimmy>=2.0'`
- Learning: Shimmy = compatibility shim between Gym versions

**9. Image Format Incompatibility** âœ…
- Error: `AssertionError: You should use NatureCNN only with images not with Box(...(84, 84, 4)...)`
- Issue: Channel-last `(H, W, C)` format, PyTorch needs channel-first `(C, H, W)`
- Fix: Created `TransposeWrapper` using `np.transpose(obs, (2, 0, 1))`
- Learning: NumPy/TensorFlow use (H,W,C), PyTorch uses (C,H,W)!

**10. Normalization API Version** âœ…
- Error: `TypeError: DQN.__init__() got an unexpected keyword argument 'normalize_images'`
- Issue: Tried to pass parameter that doesn't exist in this SB3 version
- Fix: Removed `NormalizeWrapper`, keep images as uint8 [0,255], let SB3 normalize
- Learning: Match preprocessing to what the library expects!

**11. Gym API Compatibility - Parameters** âœ…
- Error: `TypeError: JoypadSpace.reset() got an unexpected keyword argument 'seed'`
- Issue: New Gym passes `seed` kwarg, old `JoypadSpace` doesn't accept it
- Fix: Created `CompatibilityWrapper` with try/except for kwargs
- Learning: Build adapters at API boundaries!

**12. Gym API Compatibility - Return Values** âœ…
- Error: `ValueError: too many values to unpack (expected 2)`
- Issue: Old API returns `obs`, new API expects `(obs, info)` tuple
- Fix: Updated wrappers to always return `(obs, info)` tuple
- Learning: When overriding base methods, match expected interface!

### Final Working Pipeline

```python
env = gym_super_mario_bros.make("SuperMarioBros-v3")
env = JoypadSpace(env, SIMPLE_MOVEMENT)      # 256 â†’ 7 actions
env = CompatibilityWrapper(env)              # Old/new Gym API bridge
env = GrayscaleWrapper(env)                  # RGB â†’ Grayscale
env = ResizeWrapper(env)                     # 240Ã—256 â†’ 84Ã—84
# NormalizeWrapper REMOVED - SB3 handles it
env = FrameStackWrapper(env, num_stack=4)    # Stack 4 frames
env = TransposeWrapper(env)                  # (H,W,C) â†’ (C,H,W)
# Final: (4, 84, 84) uint8 [0, 255] âœ…
```

### Test Run Results (1000 timesteps)

âœ… Training completed successfully
âœ… Wandb logging working
âœ… PostgreSQL logging working (experiment_id: 9)
âœ… Model saved: `models/dqn_baseline_world1-1_final`
âœ… Git metadata tracked: 4ce6ec4a, Python 3.11.14, PyTorch 2.9.1+cu128

## ğŸ§  What I Learned

### The Reality of ML Engineering

**What tutorials show**: "Just run this and it works!"
**What actually happens**: 12 errors, 3 hours of debugging, library incompatibilities

This IS the job. Tutorials skip this, but THIS is where 50% of dev time goes!

### Wrapper Pattern Power

Built 5 custom wrappers today (6th removed):
1. **CompatibilityWrapper** - Bridges old/new Gym API
2. **GrayscaleWrapper** - RGB â†’ grayscale
3. **ResizeWrapper** - Downsampling
4. **FrameStackWrapper** - Temporal context
5. **TransposeWrapper** - Format conversion

Each does ONE thing. Composed together = sophisticated preprocessing pipeline!

### Image Format Conventions Matter

- **NumPy/TensorFlow**: `(Height, Width, Channels)` = `(84, 84, 4)`
- **PyTorch**: `(Channels, Height, Width)` = `(4, 84, 84)`

Different frameworks, different conventions. ALWAYS check docs!

### API Compatibility Strategies

**The Problem**: Old gym-super-mario-bros + new Stable-Baselines3

**The Solution**: Compatibility shim that:
1. Tries new API (with kwargs)
2. Falls back to old API (without kwargs)
3. Normalizes return values (ensure tuple)

This is what `shimmy` does - we built a mini version!

### Metadata for Reproducibility

Added tracking for:
- Git commit hash (4ce6ec4a)
- Python version (3.11.14)
- PyTorch version (2.9.1+cu128)

Why? 3 months from now I can reproduce EXACTLY this experiment!

### Systematic Debugging

1. Read error message carefully
2. Understand root cause
3. Research solution
4. Implement fix
5. Test
6. Move to next error

No shortcuts, no guessing - methodical wins!

## ğŸ’¡ Challenges & Solutions

### Challenge: 12 Cascading Errors

**Feel**: Frustrating! Each fix revealed a new error (whack-a-mole!)
**Reality**: Normal for first integration - setup code isn't tested until you run it
**Approach**: Patience + systematic debugging
**Result**: Every error taught something valuable

### Challenge: API Compatibility Hell

**Problem**: Mixing old libraries (gym-super-mario-bros) with new (SB3, shimmy)
**Root Cause**: Library ecosystem transition (Gym â†’ Gymnasium) incomplete
**Solution**: Built compatibility shim wrappers
**Learning**: When integrating legacy + modern code, expect API mismatches

## ğŸ”œ Next Steps

- [ ] **Run full 2M timestep training** (About to start!)
- [ ] Create evaluation script (Phase 3)
- [ ] Build analysis notebook (Phase 3)

## ğŸ’» Code Added Today

**Files Modified:**
- `src/environments/wrappers.py` - Added CompatibilityWrapper, TransposeWrapper, fixed FrameStackWrapper
- `src/environments/mario_env.py` - Updated wrapper chain, added CompatibilityWrapper
- `src/training/train.py` - Added metadata tracking (git/Python/PyTorch versions), fixed config keys
- `src/utils/db_logger.py` - Fixed SQL typo, updated password
- Created `__init__.py` in 7 directories

**Dependencies Added:**
- `stable-baselines3`
- `shimmy>=2.0`

## ğŸ“ Notes

**Timeline**:
- 8:29 AM: First test run attempt
- 8:29-9:25 AM: Fixed 12 errors systematically
- 9:25 AM: **SUCCESS!** First training run complete
- 9:30 AM: Database cleanup, ready for full run

**Debugging Mindset**: Each error was a learning opportunity:
- Python package system
- Configuration management
- Database integration
- API compatibility
- Deep learning conventions
- Defensive programming

**Phase 3 Progress**: 9/12 tasks complete (75%)
- âœ… End-to-end test run (1000 timesteps)
- â³ Full training (2M timesteps) - starting now!
- â³ Evaluation script
- â³ Analysis notebook

**Connection to cybersecurity goals**:
- Dependency management â†’ security tool deployment
- API compatibility â†’ integrating security products
- Metadata tracking â†’ incident investigation
- Defensive programming â†’ vulnerability prevention
- Systematic debugging â†’ incident response

_Session: 8:29 AM - 9:30 AM (3 hours of focused debugging)_
_Errors fixed: 12_
_Successful runs: 1 (after 9 failed attempts!)_

**Ready for the BIG run! ğŸš€**

[[daily]]
