---
id: "2025-12-30"
aliases: []
tags:
  - daily-notes
  - mario-rl-project
  - python-environments
  - debugging
  - phase-2-start
created: 2025-12-30
---
# ðŸ“… Monday, December 30, 2025

> _Week 1 of 2026_

## ðŸŽ¯ Today's Goals

- [x] Set up Python 3.11 environment for gym-super-mario-bros compatibility
- [x] Install and test gym-super-mario-bros environment
- [x] Begin Phase 2: Baseline Agent
- [x] Verify all dependencies work correctly

## âœ… What I Accomplished

- [x] Debugged and resolved Python version conflicts âœ… 2025-12-30
- [x] Discovered Poetry `env use` bug with Python 3.14 system default âœ… 2025-12-30
- [x] Manually created Python 3.11 virtual environment âœ… 2025-12-30
- [x] Fixed NumPy 2.0 compatibility issue with gym-super-mario-bros âœ… 2025-12-30
- [x] Successfully tested Mario environment (observation and action spaces verified) âœ… 2025-12-30
- [x] Reinstalled pre-commit hooks for new venv âœ… 2025-12-30
- [x] **Completed first Phase 2 task: Install and test gym-super-mario-bros environment** âœ… 2025-12-30

## ðŸ§  What I Learned

### Python Virtual Environments

- **Virtual envs use symlinks, not copies**: When you create a venv, Python creates symlinks pointing to the system Python interpreter, not full copies
- **Symlink chains**: Used `readlink -f` to follow symlink chains to find the actual executable being used
- **venv internals**: `.venv/bin/python` is a symlink that determines which Python version the venv uses
- **System default vs venv Python**: Shell prompts show system default Python, but `poetry run` uses the venv's Python
- **Manual venv creation**: `python3.11 -m venv .venv` directly uses Python's built-in venv module, bypassing Poetry

### Poetry Configuration

- **Config hierarchy**: Global config (`~/.config/pypoetry/config.toml`) vs project config (`poetry.toml`)
- **`virtualenvs.in-project`**: Setting to `true` creates `.venv` in project directory instead of Poetry's cache
- **`virtualenvs.use-poetry-python`**: When `false`, Poetry uses system Python based on version specification (what we want)
- **Poetry cache**: Located at `~/.cache/pypoetry` and can contain stale interpreter data
- **`poetry env use` bug**: When system default is newer Python (3.14), Poetry's `env use /usr/bin/python3.11` incorrectly creates venv with 3.14 instead

### Debugging Methodology

- **Trust but verify**: Always check if commands actually worked (don't assume)
- **Follow the symlinks**: Used `ls -la` and `readlink -f` to trace what's actually happening
- **Direct verification over metadata**: When tool output contradicts itself, test directly (`.venv/bin/python --version`)
- **When abstractions fail, go deeper**: Poetry wrapper buggy â†’ use Python's venv module directly
- **Systematic debugging**: Verify assumptions â†’ check config â†’ trace execution â†’ find root cause

### Dependency Management

- **NumPy 2.0 breaking changes**: Old `gym` library doesn't support NumPy 2.0
- **gym vs gymnasium**: `gym` unmaintained since 2022, but `gym-super-mario-bros` still depends on it
- **Version pinning**: Used `poetry add "numpy<2.0"` to constrain to compatible version
- **Compatibility cascades**: One incompatible dependency (NumPy 2.0) can break entire dependency chain

### Super Mario Bros Environment

- **Observation space**: 240x256x3 RGB NumPy arrays (NES screen resolution)
- **Action space**: Discrete(256) - all possible button combinations
- **Frame data**: uint8 values from 0-252 representing pixel colors
- **Old gym API**: `env.reset()` returns ndarray (not tuple), triggers warnings but works

## ðŸ’¡ Challenges & Solutions

### Challenge 1: Python 3.14 Incompatibility
**Problem**: gym-super-mario-bros doesn't support Python 3.14 (too new)
**Attempted**: Updated `pyproject.toml` to require Python 3.11-3.14
**Solution**: Needed to manually create venv with Python 3.11

### Challenge 2: Poetry `env use` Ignored Requests
**Problem**: `poetry env use /usr/bin/python3.11` created venv with Python 3.14 instead
**Investigation**:
- Verified `/usr/bin/python3.11` is genuine (not a symlink to 3.14)
- Checked Poetry config (correct settings)
- Traced venv symlinks: `.venv/bin/python -> /usr/bin/python3` â†’ 3.14

**Root Cause**: Poetry bug - when system default is newer Python, `env use` creates venv with wrong Python version
**Solution**: Bypass Poetry and create venv manually: `/usr/bin/python3.11 -m venv .venv`

### Challenge 3: NumPy 2.0 Compatibility
**Problem**: `OverflowError: Python integer 1024 out of bounds for uint8` when loading Mario ROM
**Cause**: gym-super-mario-bros dependencies (nes_py) not compatible with NumPy 2.0
**Solution**: Downgrade to NumPy 1.x with `poetry add "numpy<2.0"`

### Challenge 4: Confusion Between System Python and Venv Python
**Problem**: Shell prompt showed `py 3.14.0` even after creating 3.11 venv, causing confusion
**Learning**: Shell prompt shows system default; actual execution context depends on how you run commands
**Verification**: Check file paths in error tracebacks to see which Python actually ran

## ðŸ”œ Tomorrow's Focus

- [ ] Implement random agent to understand environment mechanics
- [ ] Study action space and observation space in detail
- [ ] Create basic game loop with random actions
- [ ] Log episode statistics (rewards, frames, done conditions)

## ðŸ”— Links & Context

- [[ProjectDocumentation]] - Updated Phase 2 first task completion
- [[2025-12-29|Yesterday]] - Completed Phase 1
- Test script: `src/environments/test_explore_env.py`
- Virtual environment: `.venv` (Python 3.11.14)
- Dependencies pinned: NumPy < 2.0

## ðŸ’» Code/Commands Used

```bash
# Python version verification
which python3.11  # /usr/bin/python3.11
python3.11 --version  # 3.11.14

# Poetry environment debugging
poetry env info  # Check current venv status
poetry env list  # List all venvs
poetry env remove 3.11  # Delete broken venv

# Poetry configuration
poetry config --list
poetry config virtualenvs.in-project true  # Create venv in project dir

# Attempted (buggy) venv creation
poetry env use /usr/bin/python3.11  # Created 3.14 venv instead!

# Symlink debugging
ls -la /usr/bin/python3.11  # Verify it's real executable
ls -la .venv/bin/python  # Check venv symlinks
readlink -f .venv/bin/python  # Follow symlink chain to end

# Manual venv creation (THE SOLUTION)
rm -rf .venv  # Remove Poetry's broken venv
/usr/bin/python3.11 -m venv .venv  # Create venv manually
.venv/bin/python --version  # Verify: 3.11.14 âœ…
readlink -f .venv/bin/python  # Points to /usr/bin/python3.11 âœ…

# Dependency installation
poetry install  # Install all dependencies in new venv
poetry add "numpy<2.0"  # Fix NumPy compatibility

# Pre-commit hooks
poetry run pre-commit install
poetry run pre-commit run --all-files

# Test environment
poetry run python src/environments/test_explore_env.py
```

```python
# test_explore_env.py - First successful Mario environment test
import gymnasium as gym
import gym_super_mario_bros

env = gym_super_mario_bros.make("SuperMarioBros-v3")
observation = env.reset()

print("=== OBSERVATION SPACE ===")
print(f"Type: {type(observation)}")
print(f"Shape: {observation.shape}")  # (240, 256, 3)
print(f"Data type: {observation.dtype}")  # uint8
print(f"Min value: {observation.min()}, Max value: {observation.max()}")

print("\n=== ACTION SPACE ===")
print(f"Action space: {env.action_space}")  # Discrete(256)
print(f"Number of possible actions: {env.action_space.n}")  # 256

env.close()
```

## ðŸ“ Notes

**Epic debugging session!** Spent several hours troubleshooting Python version conflicts and Poetry bugs. This was frustrating but incredibly educational.

**Key insight**: When you tell a tool to do X and it does Y instead, you've likely hit a bug or edge case. Python 3.14 is bleeding-edge (released Oct 2024), and Poetry's venv creation hasn't caught up. This taught me:
1. How to systematically debug when tools misbehave
2. When to bypass abstractions and use lower-level tools
3. How virtual environments actually work under the hood (symlinks!)
4. The importance of verifying assumptions with direct tests

**Real-world engineering**: ML tutorials never show this part - the hours spent fighting environment setup, version conflicts, and tool bugs. But this is what 50% of professional development looks like! The debugging skills learned today will transfer to every future project.

**NumPy 2.0 lesson**: Bleeding-edge isn't always better. NumPy 2.0 has breaking changes, and many ML libraries haven't caught up yet. For production work, stick with established versions unless you need specific new features.

**Connection to cybersecurity goals**: This debugging experience directly applies to:
- Troubleshooting ML model deployment issues in security contexts
- Understanding Python environment isolation for security tools
- Dependency management for security pipelines
- Systematic debugging methodology for incident response

**Victory moment**: Seeing that Mario environment output after hours of debugging was incredibly satisfying! The observation space (240x256x3 RGB frames) and action space (256 discrete actions) are exactly what we need for RL training.

**Ready for actual ML work!** Infrastructure is solid, environment tested, ready to implement the random agent and start understanding how RL training works.

_Session: 11:30 AM - 12:30 PM - First Phase 2 task complete! Taking lunch break, then onto random agent implementation._

[[daily]]
